---
layout: post
title: Linux 常用命令
date: 2016-07-04T00:00:00.000Z
desc: Linux 常用命令
keywords: 'linux, 命令, 教程'
categories:
  - Linux
tags:
  - terminal
icon: icon-html
---

## **基本命令**

- **常用命令**
  ```bash
  cat /etc/issue    查看系统版本
  cat file_a > file_b   类似cp，把file_a的内容copy到file_b中
  cat file_a >> file_b  把file_a的内容追加写到file_b里

  awk -F '@@@' '$1~/中国/' file_a  输出file_a文件中经“@@@”分割后，第一项以“中国”开头的行

  wc -l file_a  file_a的总行数

  grep '中国' file_a  在file_a中查找“中国”的记录

  less file_a   vim模式下显示部分file_a内容
  head -10 file_a   输出file_a的前10行
  tail -10 file_a   输出file_a的后10行
  tail -f  file_a   动态加载file_a的新内容

  sed -i '1d' file_a  删除file_a的第一行，就地更新
  sed -i '' 's/旧字符/新字符/g' file_a    全文替换file_a的旧字符内容

  uname -a    查看内核版本
  ifconfig    查看网络ip信息
  ps aux | head    查看前九个进程
  ps -ef | grep XXX  查看XXX的进程
  ```

## **性能监测**

- **uptime**
  ```bash
  zhangliujie-MacPro:~ Kevin$ uptime
  20:55  up 3 days, 30 mins, 2 users, load averages: 2.06 2.18 2.15

  快速查看机器的负载情况。输出分别为：1分钟 5分钟 15分钟的平均负载情况
  若1分钟的负载很高，15分钟的负载很低，说明服务器正在命令高负载情况，需排查CPU的消耗点；
  反之，若15分钟的平均负载很高，说明可能CPU的高负载期已经过去了。
  ```

- **dmesg tail**
  ```bash
  zhangliujie-MacPro:~ Kevin$ sudo dmesg | tail
  Password:
  AirPort_Brcm43xx::getKEY_RSC: Requesting RSC for index 2.
  wlIoctl(WLC_GET_KEY_SEQ) returned 0
  AirPort_Brcm43xx::getKEY_RSC: Requesting RSC for index 1.
  wlIoctl(WLC_GET_KEY_SEQ) returned 0
  AirPort_Brcm43xx::getKEY_RSC: Requesting RSC for index 2.
  wlIoctl(WLC_GET_KEY_SEQ) returned 0
  AirPort_Brcm43xx::getKEY_RSC: Requesting RSC for index 1.
  wlIoctl(WLC_GET_KEY_SEQ) returned 0
  AirPort_Brcm43xx::getKEY_RSC: Requesting RSC for index 2.
  wlIoctl(WLC_GET_KEY_SEQ) returned 0

  输出系统日志的最后10行，tail -n 可以自定义行数。根据日志记录可以辅助进一步排查性能问题。
  ```

- **vmstat 1 (mac下为：vm_stat 1)**
  ```bash
  zhangliujie-MacPro:~ Kevin$ vm_stat 1
  Mach Virtual Memory Statistics: (page size of 4096 bytes)
      free   active   specul inactive throttle    wired  prgable   faults     copy    0fill reactive   purged file-backed anonymous cmprssed cmprssor  dcomprs   comprs  pageins  pageout  swapins swapouts
     23497   698643      695   614983        0   330168   132325  221969K  9899666  136372K  6011919 10938866      327963    986358  1303423   428488  8534530 16248505  4096287   754357   461346   597024

  参数 1 表示每1秒输出一次
  free : 系统当前可用内存
  swapins swapouts : 交换区的写入和读取数量，当值不为0时，说明已经在使用交换区，值过大时可能表示物理内存已经不足

  linux下：
  zhangliujie@ailabZhou:~$ vmstat 1
  procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
   r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
  12  0  44312 3374972 204180 1718456    0    6    35     8    2    1 73  1 25  0  0
  12  0  44312 3374972 204180 1718456    0    0     0     0 3068  148 99  1  0  0  0
  12  0  44312 3374760 204180 1718488    0    0     0     0 3112   49 99  1  0  0  0
  12  0  44312 3374760 204180 1718488    0    0     0     0 3105  122 99  1  0  0  0
  r : 等待CPU资源的进程数，不包含等待IO的进程，若值大于机器的CPU核数，则表明CPU的资源已经饱和
  us、sy、id、wt、st : 代表了CPU的时间消耗，分别表示用户时间(user)、系统内核时间(sys)、空闲时间(idle)、IO等待时间(wait)、被偷走的时间(stolen如虚拟机消耗)
  一般情况下，当用户时间和系统时间值较大时，表示CPU忙于执行指令；如果IO等待时间长，则瓶颈出现在磁盘IO
  ```

- **mpstat -p ALL 1**
  ```bash
  ailab@ailabZhou:~$ mpstat -P ALL 1
  Linux 3.19.0-49-generic (ailabZhou) 2016年09月18日 _x86_64_    (12 CPU)

  21时43分54秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle
  21时43分55秒  all   98.17    0.00    1.83    0.00    0.00    0.00    0.00    0.00    0.00    0.00
  21时43分55秒    0  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00
  21时43分55秒    1  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00
  21时43分55秒    2   96.97    0.00    3.03    0.00    0.00    0.00    0.00    0.00    0.00    0.00
  21时43分55秒    3  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00
  21时43分55秒    4   99.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00
  21时43分55秒    5   97.98    0.00    2.02    0.00    0.00    0.00    0.00    0.00    0.00    0.00
  21时43分55秒    6   98.00    0.00    2.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00
  21时43分55秒    7   98.00    0.00    2.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00
  21时43分55秒    8   97.03    0.00    2.97    0.00    0.00    0.00    0.00    0.00    0.00    0.00
  21时43分55秒    9   96.00    0.00    4.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00
  21时43分55秒   10   99.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00
  21时43分55秒   11   99.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00
  显示每个CPU的占用情况，若一个CPU占用较高，可能是一个单线程应用程序引起的。
  ```

- **pidsta 1**
  ```bash
  ailab@ailabZhou:~$ pidstat 1
  Linux 3.19.0-49-generic (ailabZhou) 2016年09月18日 _x86_64_    (12 CPU)

  21时47分59秒   UID       PID    %usr %system  %guest    %CPU   CPU  Command
  21时48分00秒  1000      1558    0.99    0.00    0.00    0.99     1  pidstat
  21时48分00秒  1009     21225 1179.21   19.80    0.00 1199.01     1  python

  输出表示python占用了1199%的CPU时间，即消耗了大约12个CPU核心的运算资源
  ```
